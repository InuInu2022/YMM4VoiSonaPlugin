<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <UseWPF>true</UseWPF>
  </PropertyGroup>

  <ItemGroup>
    <!-- README -->
    <Content Include="../../README.md">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
      <ExcludeFromSingleFile>true</ExcludeFromSingleFile>
    </Content>
    <Content Include="../../LICENSE">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
      <ExcludeFromSingleFile>true</ExcludeFromSingleFile>
    </Content>
    <Content Include="../../licenses/**">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
      <ExcludeFromSingleFile>true</ExcludeFromSingleFile>
    </Content>
    <!-- exclude -->
    <ExcludeFromPublish Include="**\*.pdb" />
    <ExcludeFromPublish Include="**\*.xml" />
    <!-- YMM4 plugins -->
    <Reference Include="$(YMM4_PATH)\YukkuriMovieMaker.Plugin.dll" />
    <Reference Include="$(YMM4_PATH)\YukkuriMovieMaker.Controls.dll" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\..\libs\SonaBridge\src\SonaBridge\SonaBridge.csproj" />
  </ItemGroup>
  <Target Name="RemovePublishDirBeforeBuild" BeforeTargets="BeforeBuild">
    <RemoveDir Directories="$(OutputPath)/publish/" />
    <Message Text="RemovePublishDirBeforeBuild" Importance="high" />
  </Target>
  <Target Name="MakeZipPackage" AfterTargets="Publish">
    <MakeDir Directories="$(OutputPath)/../../../../../publish/" />
    <Delete Files="$(OutputPath)/$(AssemblyName).pdb" />
    <Delete Files="$(OutputPath)/*.pdb" />
    <Delete Files="$(OutputPath)/publish/$(AssemblyName).pdb" />
    <Delete Files="$(OutputPath)\publish\*.pdb" />
    <Delete Files="$(OutputPath)\publish\*.xml" />
    <Delete Files="$(OutputPath)/publish/SonaBridge.pdb" />
    <Delete Files="$(OutputPath)/publish/SonaBridge.xml" />
    <Delete Files="$(OutputPath)/publish/SonaBridge.Core.Common.pdb" />
    <Delete Files="$(OutputPath)/publish/SonaBridge.Core.Win.pdb" />
    <Delete Files="$(OutputPath)/publish/YukkuriMovieMaker.Plugin.pdb" />
    <Delete Files="$(OutputPath)/publish/YukkuriMovieMaker.Controls.pdb" />

    <ZipDirectory
      SourceDirectory="$(OutputPath)/publish/"
      DestinationFile="$(OutputPath)/../../../../../publish/$(AssemblyName).ymme"
      Overwrite="true" />
    <Message Text="Actions After Publish" Importance="high" />

    <Delete Files="$(YMM4_PATH)\user\plugin\$(AssemblyName)\*" />
    <Copy
      SourceFiles="$(OutputPath)/../../../../../publish/$(AssemblyName).ymme"
      DestinationFolder="$(YMM4_PATH)\user\plugin\"
      />
    <Unzip
      SourceFiles="$(OutputPath)/../../../../../publish/$(AssemblyName).ymme" DestinationFolder="$(YMM4_PATH)\user\plugin\$(AssemblyName)\" />
  </Target>
</Project>